#!/usr/bin/env ruby
args = ARGV.to_a

path = "lib/vv/version.rb"
lines = File.read(path).split("\n")

raise "Unknown number of arguments" if args.size > 1
version = lines[1].split(" = ")[-1].gsub("'","")
if args.size < 1
  puts version
  exit
end

command = args[0]
weird = version.split(".").size != 3
raise "Only handles basic versions" if weird

major, minor, point = version.split(".").map(&:to_i)

if command == "+"
  point += 1
elsif command == "++"
  point = 0
  minor += 1
elsif command == "+++"
  point = 0
  minor = 0
  major += 1
elsif command == "reset"
  system("git checkout -- lib/vv/version.rb")
  exit
elsif command == "help"
  puts
  puts "Available commands are:"
  puts
  puts "+   - point increment"
  puts "++  - minor increment"
  puts "+++ - major increment"
  puts
  puts "reset - to revert to version in git"
  puts
  exit
end

new_version = [major, minor, point].join(".")
lines[1] = "  VERSION = '#{new_version}'"
lines << ""

File.write(path, lines.join("\n"))
